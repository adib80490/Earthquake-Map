
<!DOCTYPE html>
<meta charset="utf-8">
<style>

	body{
		background: #181828;
	}

	.subunit{
		fill: #434429;
	}
	
	div.tooltip {	
		position: absolute;			
		text-align: center;			
		width: 120px;					
		height: 100px;					
		padding: 2px;				
		font: 12px sans-serif;		
		background: lightsteelblue;	
		border: 0px;		
		border-radius: 8px;			
		pointer-events: none;
	}

</style>

<title>Earthquake Map</title>

<body>
	<script src="d3.v7.min.js"></script>
	<script src="//d3js.org/topojson.v1.min.js"></script>
<script>

function redraw(){

document.body.innerHTML = '';

var width = window.innerWidth-30,
    height = window.innerHeight-30;

	
var projection = d3.geo.mercator()
    .center([0, 0])
    .scale(width*0.1588)
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);
	
// Define the div for the tooltip
var div = d3.select("body").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0);

var magnitudeScale = d3.scale.linear()
			.domain([Math.sqrt(Math.pow(10, -1)), Math.sqrt(Math.pow(10, 8))])
			.range([0, 60]);

	
var worldMap = d3.json("https://gist.githubusercontent.com/abenrob/787723ca91772591b47e/raw/8a7f176072d508218e120773943b595c998991be/world-50m.json", function(error, countries) {
   
  svg.selectAll(".subunit")
      .data(topojson.feature(countries, countries.objects.countries).features)
    .enter().append("path")
      .attr("class", function(d) { return "subunit " + d.id; })
      .attr("d", path);
});

var earthQuakes = d3.json("https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_week.geojson", function(error, earthquakes){

	svg.selectAll(".earthQuakes")
	.data(earthquakes.features)
	.enter().append("circle")
	.attr("cx", function(d){ return (projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[0])})
	.attr("cy", function(d){return (projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[1])})
	.attr("r", function(d){return magnitudeScale(Math.sqrt(Math.pow(10, d.properties.mag)))})
	.attr("fill", function(d) { if(d.properties.alert == null){ return "#ffffff";}else{ return d.properties.alert; }})
	.on("mouseover", function(d){
		div.transition()
			.duration(200)
			.style("opacity", 0.9);
			div.html(d.properties.place + "<br> magnitude " + d.properties.mag + "<br>" + new Date(d.properties.time))
			.style("left", (d3.event.pageX) + "px")
			.style("top", (d3.event.pageY-28) + "px");
			})
	.on("mouseout", function(d) {		
            div.transition()		
                .duration(500)		
                .style("opacity", 0);})
	.on("click", function(d){
		window.open(d.properties.url, '_blank');
	});				
});

}

redraw();

window.addEventListener("resize", redraw);

</script>